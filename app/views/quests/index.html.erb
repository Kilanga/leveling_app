<h1>Liste des quêtes</h1>

<!-- Formulaire de recherche -->
<%= form_with url: quests_path, method: :get, local: true, class: "mb-4" do %>
  <div class="input-group">
    <%= text_field_tag :query, params[:query], class: "form-control", placeholder: "Rechercher une quête..." %>
    <%= select_tag :category_id, options_from_collection_for_select(Category.all, :id, :name, params[:category_id]), include_blank: "Toutes les catégories", class: "form-select" %>
    <button type="submit" class="btn btn-primary">🔍 Rechercher</button>
  </div>
<% end %>

<ul class="list-group">
  <% @quests.each do |quest| %>
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <strong><%= quest.title %></strong>
        <p class="text-muted"><%= quest.category.name %> - <%= quest.xp %> XP</p>
      </div>

      <div>
        <%= form_with url: user_quests_path, method: :post, class: "d-inline" do %>
          <%= hidden_field_tag :quest_id, quest.id %>
          <%= check_box_tag "follow_quest", quest.id, current_user.user_quests.exists?(quest: quest), { class: "form-check-input", onchange: "this.form.submit();" } %>
        <% end %>
      </div>
    </li>
  <% end %>
</ul>
